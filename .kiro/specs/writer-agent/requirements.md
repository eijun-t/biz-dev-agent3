# Requirements Document

## Introduction
Writerエージェントは、自律型アイディエーションエージェントAIシステムの最終段階を担う専門エージェントです。Analystエージェントが詳細分析したビジネスアイデアを、三菱地所の意思決定者が即座に理解し判断できる1ページ完結型のHTML形式レポートに変換します。このエージェントは、複雑な分析データを構造化し、タブ形式で整理された見やすいレポートを生成することで、新事業提案の効率化と質の向上に貢献します。

## Requirements

### Requirement 1: レポート生成機能
**User Story:** エージェントシステムの利用者として、Analystエージェントの出力を受け取り、自動的に構造化されたHTMLレポートを生成したい。これにより、分析結果を即座に経営層へ提示できる形式に変換できる。

#### Acceptance Criteria

1. WHEN Analystエージェントからビジネスアイデアの詳細分析データを受信 THEN Writerエージェント SHALL 自動的にレポート生成処理を開始する
2. IF 入力データにビジネスアイデアのタイトルが含まれていない THEN システム SHALL エラーメッセージを返し、処理を中断する
3. WHEN レポート生成が開始される THEN システム SHALL 5秒以内に処理を完了する
4. IF レポート生成中にエラーが発生 THEN システム SHALL エラーログを記録し、部分的に生成されたコンテンツを保存する
5. WHILE レポート生成処理中 THE SYSTEM SHALL 進捗状況をリアルタイムでagent_logsテーブルに記録する

### Requirement 2: HTML形式タブ構造
**User Story:** 三菱地所の新事業担当者として、ビジネスアイデアの情報をタブで切り替えて確認したい。これにより、必要な情報に素早くアクセスし、効率的に内容を把握できる。

#### Acceptance Criteria

1. WHEN HTMLレポートが生成される THEN システム SHALL 以下の5つのタブを含むHTML構造を作成する：サマリー、ビジネスモデル、市場規模及び競合プレーヤー、三菱地所が取り組む意義、検証計画
2. IF ユーザーがタブをクリック THEN システム SHALL 0.1秒以内に該当するコンテンツを表示する
3. WHEN レポートが表示される THEN システム SHALL デフォルトで「サマリー」タブをアクティブ状態で表示する
4. WHERE デスクトップブラウザでアクセス THE SYSTEM SHALL 横幅1920px以上の画面に最適化された表示を提供する
5. WHERE モバイルデバイスでアクセス THE SYSTEM SHALL レスポンシブデザインで最適化された表示を提供する

### Requirement 3: サマリーセクション生成
**User Story:** 意思決定者として、ビジネスアイデアの要点を1分以内で把握したい。そのため、重要情報が凝縮されたエグゼクティブサマリーが必要である。

#### Acceptance Criteria

1. WHEN サマリーセクションが生成される THEN システム SHALL 300文字以内でビジネスアイデアの概要を記述する
2. IF 市場規模データが利用可能 THEN システム SHALL 予想市場規模（TAM）を円単位で明記する
3. WHEN 収益予測データが存在する THEN システム SHALL 3年後の予想営業利益を円単位で含める
4. IF 三菱地所のシナジースコアが計算されている THEN システム SHALL スコアを100点満点で表示する
5. WHERE 実装難易度が評価されている THE SYSTEM SHALL 難易度レベル（低/中/高）をビジュアルインジケーターで表示する

### Requirement 4: ビジネスモデルセクション
**User Story:** 新事業担当者として、提案されたビジネスモデルの構造を明確に理解したい。想定顧客、顧客課題、提供価値、収益構造を体系的に確認する必要がある。

#### Acceptance Criteria

1. WHEN ビジネスモデルセクションが生成される THEN システム SHALL 以下の4つのサブセクションを含める：想定顧客、顧客課題、提供価値、収益構造
2. IF 想定顧客データが提供される THEN システム SHALL ペルソナ情報（年齢層、職業、ニーズ）を構造化して表示する
3. WHEN 顧客課題が記述される THEN システム SHALL 最大5つの主要課題を優先度順にリスト表示する
4. IF 提供価値が定義されている THEN システム SHALL 競合優位性を含む価値提案を箇条書きで整理する
5. WHEN 収益構造が表示される THEN システム SHALL 収益源、価格設定、コスト構造を含む図表を生成する

### Requirement 5: 市場分析セクション
**User Story:** 投資判断を行う経営層として、市場規模と競合状況を正確に把握したい。TAM/PAM/SAMの詳細と主要競合プレーヤーの情報が必要である。

#### Acceptance Criteria

1. WHEN 市場分析セクションが生成される THEN システム SHALL TAM（総市場規模）、PAM（獲得可能市場）、SAM（実現可能市場）を円グラフまたは棒グラフで視覚化する
2. IF 競合データが利用可能 THEN システム SHALL 上位5社の競合企業を表形式で表示し、各社の強み・弱みを記載する
3. WHEN 市場成長率データが存在する THEN システム SHALL 過去3年と今後3年の成長トレンドをグラフで表示する
4. IF 地域別市場データがある THEN システム SHALL 日本市場と海外市場の比較を含める
5. WHERE 業界特有の規制情報が存在する THE SYSTEM SHALL 主要な規制要件とその影響を明記する

### Requirement 6: 三菱地所シナジー分析
**User Story:** 三菱地所の経営企画として、提案された事業が自社の強みとどのように連携するかを評価したい。既存事業とのシナジー効果を定量的に理解する必要がある。

#### Acceptance Criteria

1. WHEN 三菱地所シナジーセクションが生成される THEN システム SHALL 既存事業資産（不動産、顧客基盤、ブランド）との連携可能性を評価する
2. IF シナジースコアが計算されている THEN システム SHALL スコアの内訳（不動産活用度、顧客基盤活用度、ブランド価値向上度）を表示する
3. WHEN 具体的な連携施策が提案される THEN システム SHALL 実行可能な施策を優先度付きリストで表示する
4. IF ROI予測が可能 THEN システム SHALL 投資回収期間と期待収益率を明記する
5. WHERE リスク要因が特定されている THE SYSTEM SHALL 主要リスクと対策案をマトリックス形式で表示する

### Requirement 7: 検証計画セクション
**User Story:** プロジェクトマネージャーとして、事業アイデアの実現に向けた具体的なアクションプランを確認したい。フェーズごとのマイルストーンとKPIが明確である必要がある。

#### Acceptance Criteria

1. WHEN 検証計画セクションが生成される THEN システム SHALL 3段階のフェーズ（POC、パイロット、本格展開）に分けた計画を表示する
2. IF 各フェーズの期間が定義されている THEN システム SHALL ガントチャート形式でタイムラインを視覚化する
3. WHEN KPIが設定される THEN システム SHALL 各フェーズごとに測定可能な成功指標を定義する
4. IF 必要リソースが特定されている THEN システム SHALL 人員、予算、技術要件を表形式で整理する
5. WHERE 意思決定ポイントが存在する THE SYSTEM SHALL Go/No-Goの判断基準を明確に記載する

### Requirement 8: データ統合と整合性
**User Story:** システム管理者として、Writerエージェントが他のエージェントからのデータを正確に統合し、一貫性のあるレポートを生成することを保証したい。

#### Acceptance Criteria

1. WHEN 複数のエージェントからデータを受信 THEN システム SHALL データの整合性を検証し、矛盾がある場合は警告を発する
2. IF 必須データが欠落している THEN システム SHALL デフォルト値を使用するか、該当セクションを「データ不足」として明示する
3. WHILE データ統合処理中 THE SYSTEM SHALL トランザクション管理を行い、部分的な更新を防ぐ
4. WHEN 数値データが処理される THEN システム SHALL 通貨単位を円（¥）に統一し、適切なフォーマット（例：¥1,000,000）で表示する
5. IF データ更新が発生 THEN システム SHALL バージョン管理を行い、変更履歴を追跡可能にする

### Requirement 9: パフォーマンスと信頼性
**User Story:** システム利用者として、Writerエージェントが高速かつ安定して動作し、重要なビジネス判断に必要な情報を確実に提供することを期待する。

#### Acceptance Criteria

1. WHEN レポート生成リクエストを受信 THEN システム SHALL 95%のケースで5秒以内に完全なレポートを生成する
2. IF 同時に複数のレポート生成要求がある THEN システム SHALL 最大10件の並行処理をサポートする
3. WHILE 高負荷状態 THE SYSTEM SHALL キューイングメカニズムを使用してリクエストを順次処理する
4. WHEN エラーが発生 THEN システム SHALL 自動リトライ機能（最大3回）を実行し、詳細なエラーログを記録する
5. WHERE システムメンテナンスが必要 THE SYSTEM SHALL グレースフルシャットダウンを実行し、処理中のタスクを完了させる