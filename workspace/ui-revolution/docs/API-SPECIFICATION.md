# API Specification Document
## MVP Worker3 - Complete API Documentation
## Version 1.0.0

---

## Table of Contents
1. [Overview](#overview)
2. [Authentication](#authentication)
3. [Endpoints](#endpoints)
4. [Response Formats](#response-formats)
5. [Error Handling](#error-handling)
6. [Rate Limiting](#rate-limiting)
7. [Performance](#performance)

---

## Overview

Base URL: `https://api.example.com/api/reports`

The Report Management API provides comprehensive functionality for searching, comparing, exporting, and managing business innovation reports generated by the AI agent system.

### Key Features
- Advanced search with 10+ filter criteria
- Multi-report comparison with diff algorithms
- Export to PDF, Excel, CSV, JSON
- Real-time updates via WebSocket
- Sub-100ms response times with caching

---

## Authentication

```http
Authorization: Bearer {token}
X-API-Key: {api_key}
```

---

## Endpoints

### 1. Advanced Search
**POST** `/api/reports/advanced-search`

Search reports with complex filtering, sorting, and aggregation.

#### Request Body
```json
{
  "query": "healthcare AI",
  "queryFields": ["title", "summary", "content", "tags"],
  "status": ["completed", "in_progress"],
  "scoreMin": 80,
  "scoreMax": 100,
  "dateFrom": "2024-01-01T00:00:00Z",
  "dateTo": "2024-12-31T23:59:59Z",
  "dateField": "created_at",
  "agents": ["researcher", "analyst"],
  "agentMatch": "any",
  "tags": ["healthcare", "ai", "innovation"],
  "tagMatch": "all",
  "isFavorite": true,
  "author": "user123",
  "sortBy": "score",
  "sortOrder": "desc",
  "page": 1,
  "limit": 20,
  "includeAggregations": true,
  "aggregateBy": ["status", "agents", "tags"],
  "useCache": true
}
```

#### Response
```json
{
  "success": true,
  "data": [
    {
      "id": "report-001",
      "title": "Healthcare AI Innovation",
      "summary": "Revolutionary AI-powered diagnostic system",
      "content": "...",
      "status": "completed",
      "score": 95,
      "tags": ["healthcare", "ai", "innovation"],
      "agents": ["researcher", "analyst", "writer"],
      "created_at": "2024-01-15T10:00:00Z",
      "updated_at": "2024-01-15T14:00:00Z",
      "is_favorite": true
    }
  ],
  "total": 150,
  "page": 1,
  "limit": 20,
  "totalPages": 8,
  "aggregations": {
    "status": {
      "completed": 80,
      "in_progress": 50,
      "draft": 20
    },
    "agents": {
      "researcher": 140,
      "analyst": 120,
      "writer": 100
    }
  },
  "responseTime": 45,
  "cached": false
}
```

### 2. Compare Reports
**POST** `/api/reports/compare`

Compare multiple reports and highlight differences.

#### Request Body
```json
{
  "reportIds": ["report-001", "report-002", "report-003"],
  "compareFields": ["title", "summary", "content", "score", "tags"],
  "diffMode": "unified",
  "contextLines": 3
}
```

#### Response
```json
{
  "success": true,
  "reportIds": ["report-001", "report-002", "report-003"],
  "comparison": {
    "title": [
      {
        "field": "title",
        "type": "modified",
        "oldValue": "Healthcare AI",
        "newValue": "Healthcare AI Innovation",
        "similarity": 0.85
      }
    ],
    "content": [
      {
        "field": "content",
        "type": "modified",
        "changes": [
          {
            "type": "add",
            "value": "New paragraph about market analysis",
            "lineNumber": 15
          },
          {
            "type": "remove",
            "value": "Outdated statistics",
            "lineNumber": 8
          }
        ],
        "similarity": 0.92
      }
    ]
  },
  "similarity": 0.89,
  "summary": "89% similar. Modified fields: title, content",
  "responseTime": 67
}
```

### 3. Export Reports
**POST** `/api/reports/export`

Export reports in various formats.

#### Request Body
```json
{
  "reportIds": ["report-001", "report-002"],
  "format": "pdf",
  "options": {
    "includeCharts": true,
    "includeMetadata": true,
    "includeComments": false,
    "template": "detailed",
    "orientation": "portrait",
    "pageSize": "a4"
  },
  "batch": true
}
```

#### Response
Binary file download with appropriate headers:
```http
Content-Type: application/pdf
Content-Disposition: attachment; filename="reports_1234567890.pdf"
Content-Length: 245678
X-Response-Time: 234ms
```

### 4. Save Report
**POST** `/api/reports/save`

Create or update a report.

#### Request Body
```json
{
  "id": "report-001",
  "title": "Updated Report Title",
  "summary": "Updated summary",
  "content": "Updated content",
  "status": "completed",
  "score": 95,
  "tags": ["ai", "healthcare"],
  "agents": ["researcher", "analyst"],
  "metadata": {
    "version": 2,
    "lastEditor": "user123"
  }
}
```

#### Response
```json
{
  "success": true,
  "id": "report-001",
  "version": 2,
  "responseTime": 75
}
```

### 5. Get Report
**GET** `/api/reports/{id}`

Retrieve a single report by ID.

#### Response
```json
{
  "success": true,
  "data": {
    "id": "report-001",
    "title": "Healthcare AI Innovation",
    "summary": "...",
    "content": "...",
    "status": "completed",
    "score": 95,
    "tags": ["healthcare", "ai"],
    "agents": ["researcher", "analyst", "writer"],
    "created_at": "2024-01-15T10:00:00Z",
    "updated_at": "2024-01-15T14:00:00Z",
    "metadata": {
      "version": 1,
      "views": 150,
      "downloads": 25
    }
  },
  "responseTime": 32
}
```

### 6. Delete Report
**DELETE** `/api/reports/{id}`

Delete a report by ID.

#### Response
```json
{
  "success": true,
  "message": "Report deleted successfully",
  "responseTime": 45
}
```

### 7. Batch Operations
**POST** `/api/reports/batch`

Perform batch operations on multiple reports.

#### Request Body
```json
{
  "operation": "archive",
  "reportIds": ["report-001", "report-002", "report-003"]
}
```

#### Response
```json
{
  "success": true,
  "affected": 3,
  "message": "3 reports archived successfully",
  "responseTime": 120
}
```

---

## Response Formats

### Success Response
```json
{
  "success": true,
  "data": {},
  "responseTime": 45,
  "cached": false
}
```

### Error Response
```json
{
  "success": false,
  "error": "Error message",
  "details": {
    "field": "specific error detail"
  },
  "responseTime": 12
}
```

---

## Error Handling

### HTTP Status Codes
- **200 OK**: Successful request
- **201 Created**: Resource created successfully
- **400 Bad Request**: Invalid request parameters
- **401 Unauthorized**: Authentication required
- **403 Forbidden**: Access denied
- **404 Not Found**: Resource not found
- **429 Too Many Requests**: Rate limit exceeded
- **500 Internal Server Error**: Server error

### Error Types
```json
{
  "VALIDATION_ERROR": "Invalid input parameters",
  "AUTH_ERROR": "Authentication failed",
  "NOT_FOUND": "Resource not found",
  "RATE_LIMIT": "Rate limit exceeded",
  "SERVER_ERROR": "Internal server error"
}
```

---

## Rate Limiting

- **Default**: 100 requests per minute
- **Search**: 50 requests per minute
- **Export**: 10 requests per minute
- **Batch**: 5 requests per minute

Headers:
```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1234567890
```

---

## Performance

### Target Metrics
- **P50 Response Time**: < 50ms
- **P95 Response Time**: < 100ms
- **P99 Response Time**: < 200ms
- **Cache Hit Rate**: > 80%
- **Availability**: 99.9%

### Optimization Strategies
1. **Caching**: 60-second TTL on search results
2. **Indexing**: Full-text search with PostgreSQL GIN indexes
3. **Connection Pooling**: Max 100 concurrent connections
4. **CDN**: Static assets served via CloudFront
5. **Compression**: Gzip for responses > 1KB

---

## WebSocket Events

### Connection
```javascript
ws://api.example.com/ws
```

### Events
```javascript
// Subscribe to updates
{
  "type": "subscribe",
  "channel": "reports",
  "filters": {
    "status": ["in_progress"]
  }
}

// Receive updates
{
  "type": "update",
  "channel": "reports",
  "data": {
    "id": "report-001",
    "status": "completed",
    "score": 95
  },
  "timestamp": "2024-01-15T14:00:00Z"
}
```

---

## SDK Examples

### JavaScript/TypeScript
```typescript
import { ReportApiClient } from '@company/report-api';

const client = new ReportApiClient({
  apiKey: 'your-api-key',
  baseUrl: 'https://api.example.com'
});

// Search reports
const results = await client.search({
  query: 'healthcare',
  status: ['completed'],
  scoreMin: 80
});

// Export to PDF
const pdf = await client.export(
  ['report-001', 'report-002'],
  'pdf',
  { template: 'detailed' }
);
```

### Python
```python
from report_api import ReportClient

client = ReportClient(
    api_key='your-api-key',
    base_url='https://api.example.com'
)

# Search reports
results = client.search(
    query='healthcare',
    status=['completed'],
    score_min=80
)

# Compare reports
comparison = client.compare(
    report_ids=['report-001', 'report-002'],
    diff_mode='unified'
)
```

---

## Changelog

### Version 1.0.0 (2024-01-15)
- Initial release
- Advanced search with 10+ filters
- Multi-report comparison
- Export to 4 formats
- WebSocket real-time updates
- Sub-100ms response times

---

## Contact

For API support, contact:
- Email: api-support@example.com
- Documentation: https://docs.example.com/api
- Status: https://status.example.com

---

*Generated by MVP Worker3 - Quality Assurance Complete*